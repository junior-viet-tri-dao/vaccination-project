<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý giá vắc xin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/alert-utils.js}"></script>
</head>
<body class="bg-rose-100 min-h-screen p-4 md:p-6 flex items-start justify-center">

<div class="bg-white shadow-xl rounded-lg w-full max-w-6xl p-6">

    <!-- Tiêu đề -->
    <h2 class="text-3xl font-bold text-rose-700 text-center mb-6">
        Quản lý giá vắc xin
    </h2>

    <!-- Bảng -->
    <div class="overflow-x-auto w-full">
        <table class="min-w-full border border-gray-300 text-center">
            <thead class="bg-gray-200 text-gray-700">
            <tr>
                <th class="border px-4 py-2">STT</th>
                <th class="border px-4 py-2">Mã Vắc xin</th>
                <th class="border px-4 py-2">Đơn vị</th>
                <th class="border px-4 py-2">Năm SX</th>
                <th class="border px-4 py-2">Giá</th>
                <th class="px-4 py-3 text-center">Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="vp, iterStat : ${vaccinePrices}" class="bg-white hover:bg-rose-50">
                <td class="border px-4 py-2"
                    th:text="${iterStat.index + 1 + (currentPage * pageSize)}"></td>
                <td class="border px-4 py-2" th:text="${vp.vaccineCode}"></td>
                <td class="border px-4 py-2" th:text="${vp.unit}"></td>
                <td class="border px-4 py-2" th:text="${vp.productionYear}"></td>
                <td class="border px-4 py-2"
                    th:text="${#numbers.formatInteger(vp.unitPrice, 3, 'POINT')}"></td>

                <!-- Thao tác -->
                <td class="border px-4 py-2">
                    <div class="flex items-center justify-center gap-2">
                        <!-- Nút sửa -->
                        <button type="button"
                                class="btn-edit bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-md"
                                th:data-id="${vp.batchId}"
                                th:data-code="${vp.vaccineCode ?: ''}"
                                th:data-unit="${vp.unit ?: ''}"
                                th:data-year="${vp.productionYear ?: ''}"
                                th:data-price="${vp.unitPrice ?: ''}">
                            Sửa
                        </button>

                        <!-- Nút xóa -->
                        <form th:id="'deleteForm-' + ${vp.batchId}"
                              th:action="@{/finance/vaccine-price/delete}" method="post"
                              class="inline-block">
                            <input type="hidden" name="batchId" th:value="${vp.batchId}">
                            <button type="button"
                                    class="btn-delete bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md"
                                    th:data-id="${vp.batchId}"
                                    th:data-name="${vp.vaccineCode}">
                                Xóa
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Phân trang -->
        <div class="flex justify-center items-center mt-6 space-x-2">
            <div th:if="${totalPages > 0}" class="inline-flex items-center gap-2">

                <!-- Nút Trước -->
                <a th:if="${currentPage > 0}"
                   th:href="@{/finance/vaccine-price(page=${currentPage - 1}, size=${pageSize})}"
                   class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600">Trước</a>
                <span th:if="${currentPage == 0}"
                      class="px-4 py-2 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed">Trước</span>

                <!-- Số trang -->
                <span th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:href="@{/finance/vaccine-price(page=${i - 1}, size=${pageSize})}"
                       th:text="${i}"
                       th:classappend="${i - 1 == currentPage} ?
                         'bg-blue-600 text-white' :
                         'bg-gray-200 text-gray-700 hover:bg-blue-400 hover:text-white'"
                       class="px-3 py-1 rounded-lg mx-1 transition"></a>
                </span>

                <!-- Nút Sau -->
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/finance/vaccine-price(page=${currentPage + 1}, size=${pageSize})}"
                   class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600">Sau</a>
                <span th:if="${currentPage == totalPages - 1}"
                      class="px-4 py-2 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed">Sau</span>
            </div>
        </div>

    </div>

</div>

<!-- Modal sửa đặt ngoài bảng, chỉ có 1 cái -->
<div th:replace="~{financeEmployee/edit-vaccine-price :: editVaccinePriceModal}"></div>

<script>
    // Mở modal khi click nút sửa
    document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', function () {
            document.getElementById("editBatchId").value = this.dataset.id || "";
            document.getElementById("editVaccineCode").value = this.dataset.code || "";
            document.getElementById("editUnit").value = this.dataset.unit || "";
            document.getElementById("editProductionYear").value = this.dataset.year || "";
            document.getElementById("editUnitPrice").value = this.dataset.price || "";

            document.getElementById("editModal").classList.remove("hidden");
        });
    });

    // Hàm đóng modal
    function closeEditModal() {
        document.getElementById("editModal").classList.add("hidden");
    }
</script>

<script th:src="@{/js/global.js}"></script>
<div th:replace="~{alert :: alerts}"></div>
</body>
</html>