<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý giao dịch khách hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/alert-utils.js}"></script>
</head>
<body class="bg-rose-100 min-h-screen p-4 md:p-6 flex items-start justify-center">

<div class="bg-white shadow-xl rounded-lg w-full max-w-7xl p-6">

    <h2 class="text-3xl font-bold text-rose-700 text-center mb-6">
        Quản lý giao dịch khách hàng
    </h2>

    <!-- Nút thêm -->
    <div class="flex justify-end mb-4">
        <a th:href="@{/finance/transactions-customer/create}"
           class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center gap-1">
            ➕ Thêm mới
        </a>
    </div>

    <!-- Bảng -->
    <div class="overflow-x-auto w-full">
        <table class="min-w-full border border-gray-300 text-center">
            <thead class="bg-gray-200 text-gray-700">
            <tr>
                <th class="border px-4 py-2">STT</th>
                <th class="border px-4 py-2">Ngày</th>
                <th class="border px-4 py-2">Mã Hóa Đơn</th>
                <th class="border px-4 py-2">Mã Vắc xin</th>
                <th class="border px-4 py-2">Số Lượng</th>
                <th class="border px-4 py-2">Tên Khách Hàng</th>
                <th class="border px-4 py-2">Giá (VND)</th>
                <th class="px-4 py-3 text-center">Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="tc, iterStat : ${transactions}" class="bg-white hover:bg-rose-50">
                <!-- STT -->
                <td class="border px-4 py-2"
                    th:text="${iterStat.index + 1 + (currentPage * pageSize)}"></td>

                <!-- Ngày -->
                <td class="border px-4 py-2"
                    th:text="${tc.ngayHD != null} ? ${#temporals.format(tc.ngayHD, 'dd/MM/yyyy HH:mm')} : '-'"></td>

                <!-- Mã Hóa Đơn -->
                <td class="border px-4 py-2" th:text="${tc.maHoaDon}"></td>

                <!-- Mã Vắc xin -->
                <td class="border px-4 py-2" th:text="${tc.maVacXin}"></td>

                <!-- Số lượng -->
                <td class="border px-4 py-2" th:text="${tc.soLuong}"></td>

                <!-- Tên Khách Hàng -->
                <td class="border px-4 py-2" th:text="${tc.tenKhachHang}"></td>

                <!-- Giá -->
                <td class="border px-4 py-2" th:text="${tc.gia}"></td>

                <!-- Thao tác -->
                <td class="border px-4 py-2">
                    <div class="flex items-center justify-center gap-2">
                        <!-- Sửa -->
                        <a th:href="@{/finance/transactions-customer/edit/{id}(id=${tc.maHoaDon})}"
                           class="px-3 py-1 bg-yellow-500 text-white rounded-md hover:bg-yellow-600">
                            Sửa
                        </a>

                        <!-- Xóa -->
                        <form th:id="'deleteForm-' + ${tc.maHoaDon}"
                              th:action="@{/finance/transactions-customer/delete}" method="post"
                              class="inline-block">
                            <input type="hidden" name="maHoaDon" th:value="${tc.maHoaDon}">
                            <button type="button"
                                    class="btn-delete bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md"
                                    th:data-id="${tc.maHoaDon}"
                                    th:data-name="${tc.maHoaDon}">
                                Xóa
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Phân trang -->
        <div class="flex justify-center items-center mt-6 space-x-2">
            <div th:if="${totalPages > 0}" class="inline-flex items-center gap-2">
                <a th:if="${currentPage > 0}"
                   th:href="@{/finance/transactions-customer(page=${currentPage - 1}, size=${pageSize})}"
                   class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600">Trước</a>
                <span th:if="${currentPage == 0}"
                      class="px-4 py-2 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed">Trước</span>

                <span th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:href="@{/finance/transactions-customer(page=${i - 1}, size=${pageSize})}"
                       th:text="${i}"
                       th:classappend="${i - 1 == currentPage} ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-blue-400 hover:text-white'"
                       class="px-3 py-1 rounded-lg mx-1 transition"></a>
                </span>

                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/finance/transactions-customer(page=${currentPage + 1}, size=${pageSize})}"
                   class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600">Sau</a>
                <span th:if="${currentPage == totalPages - 1}"
                      class="px-4 py-2 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed">Sau</span>
            </div>
        </div>
    </div>

</div>

<script th:src="@{/js/global.js}"></script>
<div th:replace="~{alert :: alerts}"></div>
</body>
</html>
